<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>My City, Jinja</title>
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>

    <div id='map'></div>
    <script>
        L.mapbox.accessToken = 'pk.eyJ1Ijoic2FtdWVsb2tlbGxvZ3VtIiwiYSI6ImNqemZnYXVzejAyMDQzZ280NGo0aDBsbzgifQ.n3aTh1uXQs8gczGexkbTKA';
        var map = L.mapbox.map('map').setView([0.4479, 33.2026], 12).addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/light-v10'));
        map.scrollWheelZoom.disable();


        var hospitals = {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "properties": {
                    "Name": "Jinja Hospital",
                    "Address": "Rotary Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4301, 33.2053]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Nile International Hospital",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.421800, 33.202120]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "International Medical Centre",
                    "Address": "Kampala Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Alshafa Medical Center",
                    "Address": "Mpumudde"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4271, 33.2109]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Family Hope Clinic",
                    "Address": "Baxi Road"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4314402, 33.2030502]
                }
            }]
        };

        var restaurants = {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "properties": {
                    "Name": "All Friends Grill Bar and Restaurant",
                    "Address": "Rotary Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.435643, 33.199625]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Java House - Jinja",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Igar Cafe",
                    "Address": "Madhvani Rd, Plot 32"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Rumours At The Source",
                    "Address": "Nizam Road, Jinja Town"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.425830, 33.208064]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Jinja Sailing Club",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }]
        };

        var schools = {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "properties": {
                    "Name": "Horizon International School",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.434820, 33.206400]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Victoria Nile School",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.434820, 33.206402]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Main Street Primary School",
                    "Address": "Madhvani Rd, Plot 32"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.429530, 33.209950]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Wanyange Girls School",
                    "Address": "Nizam Road, Jinja Town"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.434820, 33.206400]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Busoga College Mwiri",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.421100, 33.204100]
                }
            }]
        };

        var churches = {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "properties": {
                    "Name": "St James Church of Uganda",
                    "Address": "Nile Ave Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4333, 33.2085]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Worship Harvest Church",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4267375, 33.2028555]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Jinja Full Gospel Church",
                    "Address": "Madhvani Rd, Plot 32"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4, 33]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Deliverance Church Walukuba",
                    "Address": "Nizam Road, Jinja Town"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.432700, 33.226040]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Pentecostal Church",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Jinja Christian Center",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.441590, 33.213200]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "St Andrews Church",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4195, 33.2065]
                }
            }]
        };

        var hotels = {
            "type": "FeatureCollection",
            "features": [{
                "type": "Feature",
                "properties": {
                    "Name": "Nile Village Hotel & Spa",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.421800, 33.202120]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Jinja Nile Resort",
                    "Address": "Walukuba Masese Rd"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.421800, 33.202120]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Speke Courts Hotel",
                    "Address": "Madhvani Rd, Plot 32"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.425270, 33.205580]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Pearl On The Nile Hotel",
                    "Address": "Nizam Road, Jinja Town"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4, 33]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Signature Hotel Apartments",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4, 33]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Ci'Sand Suites",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.446022, 33.197539]
                }
            }, {
                "type": "Feature",
                "properties": {
                    "Name": "Brisk Recreation Hotel Triangle",
                    "Address": "Bugembe"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [0.4, 33]
                }
            }]

        };

        // Add marker color, symbol, and size to hospital GeoJSON
        for (var i = 0; i < hospitals.features.length; i++) {
            hospitals.features[i].properties['marker-color'] = '#DC143C';
            hospitals.features[i].properties['marker-symbol'] = 'hospital';
            hospitals.features[i].properties['marker-size'] = 'small';
        }

        // Add marker color, symbol, and size to restaurants GeoJSON
        for (var j = 0; j < restaurants.features.length; j++) {
            restaurants.features[j].properties['marker-color'] = '#4169E1';
            restaurants.features[j].properties['marker-symbol'] = 'restaurant';
            restaurants.features[j].properties['marker-size'] = 'small';
        }


        // Add marker color, symbol, and size to schools GeoJSON
        for (var j = 0; j < schools.features.length; j++) {
            schools.features[j].properties['marker-color'] = '#4169E1';
            schools.features[j].properties['marker-symbol'] = 'schools';
            schools.features[j].properties['marker-size'] = 'small';
        }

        // Add marker color, symbol, and size to churches GeoJSON
        for (var j = 0; j < churches.features.length; j++) {
            churches.features[j].properties['marker-color'] = '#4169E1';
            churches.features[j].properties['marker-symbol'] = 'churches';
            churches.features[j].properties['marker-size'] = 'small';
        }

        // Add marker color, symbol, and size to hotels GeoJSON
        for (var j = 0; j < hotels.features.length; j++) {
            hotels.features[j].properties['marker-color'] = '#4169E1';
            hotels.features[j].properties['marker-symbol'] = 'hotels';
            hotels.features[j].properties['marker-size'] = 'small';
        }

        var map = L.mapbox.map('map')
            .setView([38.05, -84.5], 12)
            .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/light-v10'));
        map.scrollWheelZoom.disable();

        var hospitalLayer = L.mapbox.featureLayer(hospitals)
            .addTo(map);
        var restaurantLayer = L.mapbox.featureLayer(restaurants)
            .addTo(map);
        var schoolLayer = L.mapbox.featureLayer(schools)
            .addTo(map);
        var churchLayer = L.mapbox.featureLayer(churches)
            .addTo(map);
        var hotelLayer = L.mapbox.featureLayer(hotels)
            .addTo(map);

        // When map loads, zoom to libraryLayer features
        map.fitBounds(hotelLayer.getBounds());

        // Bind a popup to each feature in hospitalLayer and libraryLayer
        hospitalLayer.eachLayer(function(layer) {
            layer.bindPopup('<strong>' + layer.feature.properties.Name + '</strong>', {
                closeButton: false
            });
        }).addTo(map);
        restaurantLayer.eachLayer(function(layer) {
            layer.bindPopup(layer.feature.properties.Name, {
                closeButton: false
            });
        }).addTo(map);
        schoolLayer.eachLayer(function(layer) {
            layer.bindPopup(layer.feature.properties.Name, {
                closeButton: false
            });
        }).addTo(map);
        churchLayer.eachLayer(function(layer) {
            layer.bindPopup(layer.feature.properties.Name, {
                closeButton: false
            });
        }).addTo(map);
        hotelLayer.eachLayer(function(layer) {
            layer.bindPopup(layer.feature.properties.Name, {
                closeButton: false
            });
        }).addTo(map);


        // Open popups on hover
        hospitalLayer.on('mouseover', function(e) {
            e.layer.openPopup();
        });
        restaurantLayer.on('mouseover', function(e) {
            e.layer.openPopup();
        });
        schoolLayer.on('mouseover', function(e) {
            e.layer.openPopup();
        });
        churchLayer.on('mouseover', function(e) {
            e.layer.openPopup();
        });
        hotelLayer.on('mouseover', function(e) {
            e.layer.openPopup();
        });

        hospitalLayer.on('click', function(e) {
            // Get the GeoJSON from libraryFeatures and hospitalFeatures
            var restaurantFeatures = restaurantLayer.getGeoJSON();
            var hospitalFeatures = hospitalLayer.getGeoJSON();

            // Using Turf, find the nearest hospital to restaurant clicked
            var nearestHospital = turf.nearest(e.layer.feature, hospitalFeatures);

            // Change the nearest hospital to a large marker
            nearestHospital.properties['marker-size'] = 'large';

            // Add the new GeoJSON to hospitalLayer
            hospitalLayer.setGeoJSON(hospitalFeatures);
            // Bind popups to new hospitalLayer and open popup
            // for nearest hospital
            hospitalLayer.eachLayer(function(layer) {
                layer.bindPopup('<strong>' + layer.feature.properties.Name + '</strong>', {
                    closeButton: false
                });
                if (layer.feature.properties['marker-size'] === 'large') {
                    layer.openPopup();
                }
            });
        });
    </script>

</body>

</html>